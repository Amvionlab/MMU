import{n as T,j as r,r as o,u as fe,U as ge,s as be,o as we,t as H,T as je,d as ye,e as ve,g as me,h as J,i as t,k as Se,I as C,b as p,p as l}from"./index-DpzHKyVd.js";import{C as _e}from"./index-CykP0Yyl.js";import{D as Ce,a as Te,b as Le,c as ke,d as De,B as M}from"./DialogTitle-Cv6-kH8R.js";const Ne=T(r.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m-2 14-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"}),"AssignmentTurnedIn"),Re=T(r.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),$e=T(r.jsx("path",{d:"M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m13.5-9 1.96 2.5H17V9.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"LocalShipping");function Ae(){const[L,G]=o.useState(!1),{group:k,type:D,tag:g}=fe(),[K,Q]=o.useState([]),[b,X]=o.useState([]),[Y,N]=o.useState(!0),[R,Z]=o.useState(null),[w,$]=o.useState(""),[j,O]=o.useState(0),[u,ee]=o.useState(10),{user:d}=o.useContext(ge),[q,re]=o.useState(""),[a,ne]=o.useState("all"),y=be(({className:e,...n})=>r.jsx(we,{...n,classes:{popper:e}}))({[`& .${H.tooltip}`]:{backgroundColor:"purple",color:"white",fontSize:"0.875rem"},[`& .${H.arrow}`]:{color:"purple"}}),[P,A]=o.useState(""),[te,I]=o.useState(!1),[x,B]=o.useState(null),[f,E]=o.useState(null),v=()=>{G(!L)},se=[{label:"ID",key:"id"},{label:"Transfer From",key:"from_location"},{label:"Transfer To",key:"to_location"},{label:"Description",key:"description"},{label:"Request By",key:"request_by"},{label:"Request On",key:"request_on"},{label:"Approved By",key:"approved_by"},{label:"Approved On",key:"approved_on"},{label:"Transfer By",key:"transfer_by"},{label:"Transfer On",key:"transfer_on"},{label:"Received By",key:"received_by"},{label:"Received On",key:"received_on"}],oe=(e,n)=>{O(n)},ae=e=>{ee(+e.target.value),O(0)},W=decodeURIComponent(k),F=decodeURIComponent(D),m=decodeURIComponent(g),[ce,ie]=o.useState([]);o.useEffect(()=>{(async()=>{try{const s=await(await fetch(`${p}/backend/dropdown.php`)).json();ie(s.locations)}catch(n){console.error("Error fetching data:",n)}})()},[]);const h=async()=>{try{const e=`${p}/backend/fetchTransfer.php?action=fetch&group=${W}&type=${F}&tag=${m}`,n=await fetch(e);if(!n.ok)throw new Error("Network response was not ok");const s=await n.json();Q(s);const i=`${p}/backend/fetchDetailedView.php?group=${W}&type=${F}&tag=${m}`,V=await fetch(i);if(!V.ok)throw new Error("Network response was not ok");const xe=await V.json();X(xe),N(!1)}catch(e){console.error("Error fetching data:",e),Z(e.toString()),N(!1)}};o.useEffect(()=>{h()},[k,D,g]);const le=e=>{if(e.preventDefault(),!w.trim())return;const n={tag:g,notes:w,fromLocation:b.location,toLocation:P,user:d.firstname};fetch(`${p}/backend/fetchTransfer.php?action=add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(s=>s.json()).then(s=>{s.success?(A(""),$(""),v(),h(),l.success("Transfer Request Added")):console.error("Failed to add note:",s.error)}).catch(s=>{console.error("Error adding note:",s)})};function c(e){return e&&!e.startsWith("0000-00-00")&&!isNaN(new Date(e).getTime())}const S=K.filter(e=>{const n=q.toLowerCase();return a==="all"?e.id.toString().toLowerCase().includes(n)||e.from_location.toLowerCase().includes(n)||e.to_location.toLowerCase().includes(n)||e.description.toLowerCase().includes(n)||e.request_by.toLowerCase().includes(n)||c(e.request_on)&&new Date(e.request_on).toLocaleString().toLowerCase().includes(n)||e.approved_by.toLowerCase().includes(n)||c(e.approved_on)&&new Date(e.approved_on).toLocaleString().toLowerCase().includes(n)||e.transfer_by.toLowerCase().includes(n)||c(e.transfer_on)&&new Date(e.transfer_on).toLocaleString().toLowerCase().includes(n)||e.received_by.toLowerCase().includes(n)||c(e.received_on)&&new Date(e.received_on).toLocaleString().toLowerCase().includes(n):a==="id"?e.id.toString().toLowerCase().includes(n):a==="from_location"?e.from_location.toLowerCase().includes(n):a==="to_location"||a==="description"?e.to_location.toLowerCase().includes(n):a==="request_by"?e.request_by.toLowerCase().includes(n):a==="request_on"&&c(e.request_on)?new Date(e.request_on).toLocaleString().toLowerCase().includes(n):a==="approved_by"?e.approved_by.toLowerCase().includes(n):a==="approved_on"&&c(e.approved_on)?new Date(e.approved_on).toLocaleString().toLowerCase().includes(n):a==="transfer_by"?e.transfer_by.toLowerCase().includes(n):a==="transfer_on"&&c(e.transfer_on)?new Date(e.transfer_on).toLocaleString().toLowerCase().includes(n):a==="received_by"?e.received_by.toLowerCase().includes(n):a==="received_on"&&c(e.received_on)?new Date(e.received_on).toLocaleString().toLowerCase().includes(n):!1}),de=async()=>{x==="out"?pe(f):x==="reject"?he(f):x==="receive"&&U(f),_()},z=(e,n)=>{B(e),E(n),I(!0)},_=()=>{I(!1),B(null),E(null)},pe=async e=>{const n={id:e,user:d.firstname};try{const s=await fetch(`${p}/backend/fetchTransfer.php?action=ofd`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),i=await s.json();s.ok&&i.success?(l.success(`Transfer ID ${e} marked as out for delivery by ${d.firstname}.`),h()):l.error(`Failed to mark Transfer ID ${e} as out for delivery. ${i.error||""}`)}catch(s){console.error("Error marking transfer as out for delivery:",s),l.error("An error occurred while marking the transfer as out for delivery.")}},he=async e=>{const n={id:e,user:d.firstname};try{const s=await fetch(`${p}/backend/fetchTransfer.php?action=reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),i=await s.json();s.ok&&i.success?(l.success(`Transfer ID ${e} rejected by ${d.firstname}.`),h()):l.error(`Failed to reject Transfer ID ${e}. ${i.error||""}`)}catch(s){console.error("Error rejecting transfer:",s),l.error("An error occurred while rejecting the transfer.")}},U=async e=>{const n={id:e,user:d.firstname};try{const s=await fetch(`${p}/backend/fetchTransfer.php?action=receive`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),i=await s.json();s.ok&&i.success?(l.success(`Transfer ID ${e} marked as received by ${d.firstname}.`),h()):l.error(`Failed to mark Transfer ID ${e} as received. ${i.error||""}`)}catch(s){console.error("Error receiving transfer:",s),l.error("An error occurred while marking the transfer as received.")}};if(Y)return r.jsx("div",{children:"Loading..."});if(R)return r.jsxs("div",{children:["Error fetching data: ",R]});const ue=ce.filter(e=>e.name!==b.location);return r.jsxs("div",{children:[r.jsxs("div",{className:"flex font-bold justify-between items-center mb-3",children:[r.jsx("h1",{className:"text-xl ",children:"Asset Transfer"}),r.jsxs("button",{className:"flex text-xs items-center px-3 py-2 bg-box border border-gray-400 shadow-inner text-prime rounded hover:shadow-md hover:border-prime transition-transform transform hover:scale-110",onClick:v,children:[r.jsx("span",{children:" + "})," New Transfer"]})]}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsxs("div",{className:"flex font-medium",children:[r.jsxs("select",{value:a,className:"text-xs border p-1 mr-2 rounded-md",onChange:e=>ne(e.target.value),style:{height:"30px"},children:[r.jsx("option",{value:"all",children:"All"}),r.jsx("option",{value:"id",children:"ID"}),r.jsx("option",{value:"from_location",children:"Transfer From"}),r.jsx("option",{value:"to_location",children:"Transfer To"}),r.jsx("option",{value:"description",children:"Description"}),r.jsx("option",{value:"request_by",children:"Request By"}),r.jsx("option",{value:"request_on",children:"Request On"}),r.jsx("option",{value:"approved_by",children:"Approved By"}),r.jsx("option",{value:"approved_on",children:"Approved On"}),r.jsx("option",{value:"transfer_by",children:"Transfer By"}),r.jsx("option",{value:"transfer_on",children:"Transfer On"}),r.jsx("option",{value:"received_by",children:"Received By"}),r.jsx("option",{value:"received_on",children:"Received On"})]}),r.jsx("input",{type:"text",id:"search-bar",placeholder:"Search",className:"text-xs border p-2 rounded-md",value:q,onChange:e=>re(e.target.value),style:{height:"30px",width:"100px"}})]}),r.jsx(je,{rowsPerPageOptions:[10,25,100,500],component:"div",count:S.length,rowsPerPage:u,page:j,onPageChange:oe,onRowsPerPageChange:ae}),r.jsx(_e,{data:S,headers:se,filename:`asset-notes-${m}.csv`,className:"flex text-xs items-center px-3 py-1 bg-box border border-gray-400 font-bold shadow-inner text-prime rounded hover:shadow-md hover:border-prime transition-transform transform hover:scale-110",children:"CSV"})]}),L&&r.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[r.jsx("div",{className:"bg-black bg-opacity-50 absolute inset-0"}),r.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg z-10 w-2/6",children:[r.jsx("h2",{className:"text-xl font-semibold mb-4",children:"New Transfer"}),r.jsxs("form",{onSubmit:le,children:[r.jsxs("div",{className:"flex gap-4",children:[r.jsxs("div",{className:"mb-4 w-1/2",children:[r.jsx("label",{children:"From"}),r.jsx("input",{value:b.location,onChange:e=>setFromLocation(e.target.value),className:"w-full px-3 py-2 border text-xs rounded-lg",disabled:!0})]}),r.jsxs("div",{className:"mb-4 w-1/2 gap-2",children:[r.jsx("label",{children:"To"}),r.jsxs("select",{value:P,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 text-xs border rounded-lg",required:!0,children:[r.jsx("option",{value:"",children:"Select Location"}),ue.map(e=>r.jsx("option",{value:e.name,children:e.name},e))]})]})]}),r.jsx("div",{className:"mb-4",children:r.jsx("textarea",{className:"w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none focus:border-prime",rows:"4",placeholder:"Enter description here...",value:w,onChange:e=>$(e.target.value),required:!0})}),r.jsxs("div",{className:"flex justify-end",children:[r.jsx("button",{type:"button",className:"bg-red-500 text-white px-4 py-2 rounded-md mr-2",onClick:v,children:"Cancel"}),r.jsx("button",{type:"submit",className:"bg-prime text-white px-4 py-2 rounded-md",children:"Transfer"})]})]})]})]}),r.jsx(ye,{sx:{maxHeight:440},children:r.jsxs(ve,{stickyHeader:!0,"aria-label":"sticky table",children:[r.jsx(me,{children:r.jsxs(J,{children:[r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"ID"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Transfer From"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Transfer To"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Description"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Request By"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Request On"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Approved By"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Approved On"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Transfer By"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Transfer On"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Received By"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Received On"}),r.jsx(t,{align:"center",sx:{whiteSpace:"nowrap",fontWeight:"bold"},children:"Action"})]})}),r.jsx(Se,{sx:{padding:"2px"},children:S.slice(j*u,j*u+u).map(e=>r.jsxs(J,{hover:!0,role:"checkbox",tabIndex:-1,className:"text-xs",children:[r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:e.id}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:e.from_location}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:e.to_location}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:e.description}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:e.request_by}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:c(e.request_on)?new Date(e.request_on).toLocaleString():""}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:e.approved_by}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:c(e.approved_on)?new Date(e.approved_on).toLocaleString():""}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:e.transfer_by}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:c(e.transfer_on)?new Date(e.transfer_on).toLocaleString():""}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:e.received_by}),r.jsx(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:c(e.received_on)?new Date(e.received_on).toLocaleString():""}),r.jsxs(t,{align:"center",sx:{padding:"10px",whiteSpace:"nowrap"},children:[e.status==="2"&&r.jsx(y,{title:"Out for Delivery",placement:"bottom",arrow:!0,children:r.jsx(C,{"aria-label":"Out for Delivery",color:"secondary",onClick:()=>z("out",e.id),children:r.jsx($e,{})})}),(e.status==="2"||e.status==="1")&&r.jsx(y,{title:"Reject",placement:"bottom",arrow:!0,children:r.jsx(C,{"aria-label":"Reject",color:"error",onClick:()=>z("reject",e.id),children:r.jsx(Re,{})})}),e.status==="3"&&"Not Received",e.status==="5"&&r.jsx(y,{title:"Receive",placement:"bottom",arrow:!0,children:r.jsx(C,{"aria-label":"Receive",color:"success",onClick:()=>U(e.id),children:r.jsx(Ne,{})})}),e.status==="4"&&"Completed"]})]},e.id))})]})}),r.jsxs(Ce,{open:te,onClose:_,children:[r.jsx(Te,{children:"Confirm Action"}),r.jsx(Le,{children:r.jsxs(ke,{children:["Are you sure you want to ",x," transfer ID ",f,"?"]})}),r.jsxs(De,{children:[r.jsx(M,{onClick:_,color:"primary",children:"Cancel"}),r.jsx(M,{onClick:de,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}export{Ae as default};
