import{u as ye,r,U as Ce,j as t,I as S,q as M,T as be,d as ve,e as Ae,g as Te,h as L,i as a,C as J,k as _e,b as m,p as c}from"./index-DpzHKyVd.js";import{d as V}from"./Cancel-DCdhTHrm.js";import{D as W,a as H,b as q,c as G,d as K,B as y}from"./DialogTitle-Cv6-kH8R.js";function Oe(){const{type:P,group:ke}=ye();r.useState(null);const[j,Q]=r.useState([]),[d,O]=r.useState(0),[l,X]=r.useState(10),[o,x]=r.useState([]),[C,ze]=r.useState([]),[h,Y]=r.useState(""),[Z,ee]=r.useState(""),[b,te]=r.useState(""),[v,ne]=r.useState([]),[se,R]=r.useState(!1),[A,I]=r.useState(null),[T,N]=r.useState(null),[_,ae]=r.useState("asc"),[u,re]=r.useState("id"),{user:p}=r.useContext(Ce),f=async()=>{try{const n=await(await fetch(`${m}/backend/fetchUnApprovedata.php?action=all`)).json();Q(n)}catch(e){console.error("Error fetching data:",e)}};r.useEffect(()=>{f()},[P]);const[oe,$]=r.useState(!1),[k,E]=r.useState(null);r.useEffect(()=>{const e=h===""||h==="All"?j.filter(n=>Object.values(n).some(s=>s==null?void 0:s.toString().toLowerCase().includes(b.toLowerCase()))):j.filter(n=>{var s;return(s=n[h])==null?void 0:s.toString().toLowerCase().includes(b.toLowerCase())});ne(e)},[h,b,j]);const U=e=>{ae(u===e&&_==="asc"?"desc":"asc"),re(e)},z=()=>v.sort((e,n)=>e[u]<n[u]?_==="asc"?-1:1:e[u]>n[u]?_==="asc"?1:-1:0),ce=e=>{const n=e.target.checked?z().slice(d*l,d*l+l).map(s=>s.id):[];x(n)},le=e=>{const n=o.indexOf(e);let s=[];n===-1?s=s.concat(o,e):n===0?s=s.concat(o.slice(1)):n===o.length-1?s=s.concat(o.slice(0,-1)):n>0&&(s=s.concat(o.slice(0,n),o.slice(n+1))),x(s)},ie=(e,n)=>{O(n),x([])},de=e=>{X(parseInt(e.target.value,10)),O(0)},pe=async()=>{A==="approve"?await xe(T):A==="reject"&&await he(T),w()},F=(e,n)=>{I(e),N(n),R(!0)},w=()=>{R(!1),I(null),N(null)},xe=async e=>{const n={id:e,user:p.firstname};try{const s=await fetch(`${m}/backend/fetchUnApprovedata.php?action=approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),i=await s.json();s.ok&&i.success?(c.success(`Transfer ID ${e} approved by ${p.firstname}.`),f()):c.error(`Failed to approve Transfer ID ${e}. ${i.error||""}`)}catch(s){console.error("Error approving transfer:",s),c.error("An error occurred while approving the transfer.")}},he=async e=>{const n={id:e,user:p.firstname};try{const s=await fetch(`${m}/backend/fetchUnApprovedata.php?action=reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),i=await s.json();s.ok&&i.success?(c.success(`Transfer ID ${e} rejected by ${p.firstname}.`),f()):c.error(`Failed to reject Transfer ID ${e}. ${i.error||""}`)}catch(s){console.error("Error rejecting transfer:",s),c.error("An error occurred while rejecting the transfer.")}},ue=async()=>{console.log("Approving selected rows:",o);const e={selectedRows:o,user:p.firstname};try{const n=await fetch(`${m}/backend/fetchUnApprovedata.php?action=approvesel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await n.json();n.ok&&s.success?(c.success("Selected Transfers are Approved."),f()):c.error(`Failed to Approve Transfers. ${s.error||""}`)}catch(n){console.error("Error approving transfer:",n),c.error("An error occurred while approving the transfer.")}finally{x([])}},fe=async()=>{console.log("Rejecting selected rows:",o);const e={selectedRows:o,user:p.firstname};console.log(e);try{const n=await fetch(`${m}/backend/fetchUnApprovedata.php?action=rejectsel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await n.json();n.ok&&s.success?(c.success("Selected Transfers are Rejected."),f()):c.error(`Failed to Reject Transfers. ${s.error||""}`)}catch(n){console.error("Error approving transfer:",n),c.error("An error occurred while approving the transfer.")}finally{x([])}},ge=()=>{k==="approve"?ue():k==="reject"&&fe(),D()},B=e=>{E(e),$(!0)},D=()=>{$(!1),E(null)},me=()=>{const e=["ID",...C.map(g=>g.column_name.replace("_"," "))],n=v.map((g,je)=>[je+1,...C.map(Se=>g[Se.column_name]||"-")]);let s="data:text/csv;charset=utf-8,"+[e.join(","),...n.map(g=>g.join(","))].join(`
`);const i=document.createElement("a");i.setAttribute("href",encodeURI(s)),i.setAttribute("download",`${P}_data.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i)};return t.jsxs("div",{className:"w-full bg-white p-1 rounded-md h-full flex flex-col",children:[t.jsx("div",{className:"flex font-bold justify-between items-center mb-3",children:t.jsx("h1",{className:"text-xl",children:"Asset Approval"})}),t.jsxs("div",{className:"w-full border-b h-10 flex text-sm justify-between items-center font-semibold mb-2",children:[o.length>0&&t.jsxs("div",{className:"flex capitalize ml-4 text-xl font-semibold",children:[t.jsx(S,{onClick:()=>B("approve"),sx:{color:"green"},children:t.jsx(M,{})}),t.jsx(S,{onClick:()=>B("reject"),sx:{color:"red",ml:1},children:t.jsx(V,{})})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsxs("select",{className:"border rounded text-xs capitalize",value:h,onChange:e=>Y(e.target.value),children:[t.jsx("option",{value:"All",children:"All"}),C.map(e=>t.jsx("option",{value:e.column_name,children:e.column_name.replace("_"," ")},e.id))]}),t.jsx("input",{type:"text",placeholder:"Enter text",className:"border rounded p-1 text-xs",value:Z,onChange:e=>{ee(e.target.value),te(e.target.value)}})]}),t.jsx("div",{className:"flex gap-1",children:t.jsx(be,{className:"compact-pagination",rowsPerPageOptions:[10,25,50,100,500,1e3],component:"div",count:v.length,rowsPerPage:l,page:d,onPageChange:ie,onRowsPerPageChange:de})}),t.jsx("div",{className:"flex gap-1",children:t.jsx("button",{onClick:me,className:"px-2 py-1 bg-second rounded border text-xs shadow-md transform hover:scale-110 transition-transform duration-200 ease-in-out",children:"CSV"})})]}),t.jsx(ve,{sx:{maxHeight:"calc(100vh - 100px)"},children:t.jsxs(Ae,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(Te,{children:t.jsxs(L,{children:[t.jsx(a,{padding:"checkbox",sx:{padding:"1px",fontSize:"12px"},children:t.jsx(J,{indeterminate:o.length>0&&o.length<j.length,checked:o.length===z().slice(d*l,d*l+l).length,onChange:ce})}),t.jsx(a,{align:"center",sx:{minWidth:50,fontWeight:600,fontSize:"12px"},children:t.jsx("button",{onClick:()=>U("id"),children:"ID"})}),["tag","name","manufacturer","model","serial_number","location","user_ID","asset_value","vendor_name","purchase_date","po_number","amc_from","amc_to","amc_interval","last_amc","procure_by","warranty_upto","Action"].map(e=>t.jsx(a,{className:"capitalize text-nowrap",align:"center",sx:{minWidth:120,fontWeight:600,fontSize:"12px"},children:t.jsx("button",{onClick:()=>U(e),children:e.replace(/_/g," ").toUpperCase()})},e))]})}),t.jsx(_e,{children:z().slice(d*l,d*l+l).map((e,n)=>t.jsxs(L,{hover:!0,role:"checkbox",tabIndex:-1,selected:o.includes(e.id),children:[t.jsx(a,{padding:"checkbox",sx:{padding:"1px",fontSize:"12px"},children:t.jsx(J,{checked:o.includes(e.id),onChange:()=>le(e.id)})}),t.jsx(a,{align:"center",sx:{padding:"2px",fontSize:"12px"},children:n+1+d*l}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.tag}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.name}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.manufacturer}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.model}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.serial_number}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.location}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.user_id}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.asset_value}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.vendor_name}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.purchase_date}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.po_number}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.amc_from}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.amc_to}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.amc_interval}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.last_amc}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.procure_by}),t.jsx(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:e.warranty_upto}),t.jsxs(a,{align:"center",sx:{padding:"1px",fontSize:"12px"},children:[t.jsx(S,{onClick:()=>F("approve",e.id),sx:{color:"green"},children:t.jsx(M,{})}),t.jsx(S,{onClick:()=>F("reject",e.id),sx:{color:"red",ml:1},children:t.jsx(V,{})})]})]},n))})]})}),t.jsxs(W,{open:se,onClose:w,children:[t.jsx(H,{children:"Confirm Action"}),t.jsx(q,{children:t.jsxs(G,{children:["Are you sure you want to ",A," transfer ID ",T,"?"]})}),t.jsxs(K,{children:[t.jsx(y,{onClick:w,color:"primary",children:"Cancel"}),t.jsx(y,{onClick:pe,color:"primary",autoFocus:!0,children:"Confirm"})]})]}),t.jsxs(W,{open:oe,onClose:D,children:[t.jsx(H,{children:"Confirm Mass Action"}),t.jsx(q,{children:t.jsxs(G,{children:["Are you sure you want to ",k," ",o.length," selected transfers?"]})}),t.jsxs(K,{children:[t.jsx(y,{onClick:D,color:"primary",children:"Cancel"}),t.jsx(y,{onClick:ge,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}export{Oe as default};
