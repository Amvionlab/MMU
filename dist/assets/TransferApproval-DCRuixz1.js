import{u as fe,r as o,U as xe,v as ge,j as s,o as je,t as E,I as j,q as B,T as me,d as ye,e as we,g as Ce,h as z,i as l,C as M,k as be,b as x,p as a}from"./index-DpzHKyVd.js";import{d as W}from"./Cancel-DCdhTHrm.js";import{C as Se}from"./index-CykP0Yyl.js";import{D as J,a as U,b as H,c as V,d as G,B as m}from"./DialogTitle-Cv6-kH8R.js";function Ae(){fe();const[T,K]=o.useState([]),[Q,v]=o.useState(!0),[k,X]=o.useState(null),[i,_]=o.useState(0),[n,u]=o.useState([]),[c,Y]=o.useState(10),{user:h}=o.useContext(xe),A=ge(({className:e,...r})=>s.jsx(je,{...r,classes:{popper:e}}))({[`& .${E.tooltip}`]:{backgroundColor:"purple",color:"white",fontSize:"0.875rem"},[`& .${E.arrow}`]:{color:"purple"}}),[Z,D]=o.useState(!1),[y,R]=o.useState(null),[w,q]=o.useState(null),[ee,P]=o.useState(!1),[C,L]=o.useState(null),[O,se]=o.useState(""),[d,re]=o.useState("all"),te=[{label:"ID",key:"id"},{label:"Transfer From",key:"from_location"},{label:"Transfer To",key:"to_location"},{label:"Description",key:"description"},{label:"Request By",key:"request_by"},{label:"Request On",key:"request_on"}],ne=(e,r)=>{_(r)},oe=e=>{Y(+e.target.value),_(0)},f=async()=>{try{const e=await fetch(`${x}/backend/fetchTransfer.php?action=all`);if(!e.ok)throw new Error("Network response was not ok");const r=await e.json();K(r),v(!1)}catch(e){console.error("Error fetching data:",e),X(e.toString()),v(!1)}};o.useEffect(()=>{f()},[]);function $(e){return e&&!e.startsWith("0000-00-00")&&!isNaN(new Date(e).getTime())}const g=T.filter(e=>{const r=O.toLowerCase();return d==="all"?e.id.toString().toLowerCase().includes(r)||e.from_location.toLowerCase().includes(r)||e.to_location.toLowerCase().includes(r)||e.description.toLowerCase().includes(r)||e.request_by.toLowerCase().includes(r)||$(e.request_on)&&new Date(e.request_on).toLocaleString().toLowerCase().includes(r):d==="id"?e.id.toString().toLowerCase().includes(r):d==="request_by"?e.request_by.toLowerCase().includes(r):d==="request_on"?e.request_on.toLowerCase().includes(r):d==="from_location"?e.from_location.toLowerCase().includes(r):d==="to_location"||d==="description"?e.to_location.toLowerCase().includes(r):!1}),ae=async()=>{y==="approve"?ce(w):y==="reject"&&le(w),b()},N=(e,r)=>{R(e),q(r),D(!0)},b=()=>{D(!1),R(null),q(null)},ce=async e=>{const r={id:e,user:h.firstname};try{const t=await fetch(`${x}/backend/fetchTransfer.php?action=approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),p=await t.json();t.ok&&p.success?(a.success(`Transfer ID ${e} approved by ${h.firstname}.`),f()):a.error(`Failed to approve Transfer ID ${e}. ${p.error||""}`)}catch(t){console.error("Error approving transfer:",t),a.error("An error occurred while approving the transfer.")}},le=async e=>{const r={id:e,user:h.firstname};try{const t=await fetch(`${x}/backend/fetchTransfer.php?action=reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),p=await t.json();t.ok&&p.success?(a.success(`Transfer ID ${e} rejected by ${h.firstname}.`),f()):a.error(`Failed to reject Transfer ID ${e}. ${p.error||""}`)}catch(t){console.error("Error rejecting transfer:",t),a.error("An error occurred while rejecting the transfer.")}},I=()=>g,ie=e=>{const r=I().slice(i*c,i*c+c);if(e.target.checked){const t=r.map(p=>p.id);u(t);return}u([])},de=e=>{const r=n.indexOf(e);let t=[];r===-1?t=t.concat(n,e):r===0?t=t.concat(n.slice(1)):r===n.length-1?t=t.concat(n.slice(0,-1)):r>0&&(t=t.concat(n.slice(0,r),n.slice(r+1))),u(t)},pe=async()=>{console.log("Approving selected rows:",n);const e={selectedRows:n,user:h.firstname};try{const r=await fetch(`${x}/backend/fetchTransfer.php?action=approvesel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await r.json();r.ok&&t.success?(a.success("Selected Transfers are Approved."),f()):a.error(`Failed to Approve Transfers. ${t.error||""}`)}catch(r){console.error("Error approving transfer:",r),a.error("An error occurred while approving the transfer.")}finally{u([])}},he=async()=>{console.log("Rejecting selected rows:",n);const e={selectedRows:n,user:h.firstname};console.log(e);try{const r=await fetch(`${x}/backend/fetchTransfer.php?action=rejectsel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await r.json();r.ok&&t.success?(a.success("Selected Transfers are Rejected."),f()):a.error(`Failed to Reject Transfers. ${t.error||""}`)}catch(r){console.error("Error approving transfer:",r),a.error("An error occurred while Rejecting the transfer.")}finally{u([])}},ue=()=>{C==="approve"?pe():C==="reject"&&he(),S()},F=e=>{L(e),P(!0)},S=()=>{P(!1),L(null)};return Q?s.jsx("div",{children:"Loading..."}):k?s.jsxs("div",{children:["Error fetching data: ",k]}):s.jsxs("div",{children:[s.jsx("div",{className:"flex font-bold justify-between items-center mb-3",children:s.jsx("h1",{className:"text-xl",children:"Asset Transfer"})}),s.jsxs("div",{className:"w-full border-b h-10 flex text-sm justify-between items-center font-semibold mb-2",children:[n.length>0&&s.jsxs("div",{className:"flex capitalize ml-4 text-xl font-semibold",children:[s.jsx(j,{onClick:()=>F("approve"),sx:{color:"green"},children:s.jsx(B,{})}),s.jsx(j,{onClick:()=>F("reject"),sx:{color:"red",ml:1},children:s.jsx(W,{})})]}),s.jsxs("div",{className:"flex font-medium",children:[s.jsxs("select",{value:d,className:"text-xs border p-1 mr-2 rounded-md",onChange:e=>re(e.target.value),style:{height:"30px",width:"75px"},children:[s.jsx("option",{value:"all",children:"All"}),s.jsx("option",{value:"from_location",children:"Transfer From"}),s.jsx("option",{value:"to_location",children:"Transfer To"}),s.jsx("option",{value:"description",children:"Description"}),s.jsx("option",{value:"request_by",children:"Request By"}),s.jsx("option",{value:"request_on",children:"Request On"})]}),s.jsx("input",{type:"text",id:"search-bar",placeholder:"Search",className:"text-xs border p-2 rounded-md",value:O,onChange:e=>se(e.target.value),style:{height:"30px",width:"150px"}})]}),s.jsx(me,{rowsPerPageOptions:[10,25,100,500],component:"div",count:g.length,rowsPerPage:c,page:i,onPageChange:ne,onRowsPerPageChange:oe}),s.jsx(Se,{data:g,headers:te,filename:"transfer-approvals.csv",className:"px-2 py-1 bg-second rounded border text-xs shadow-md transform hover:scale-110 transition-transform duration-200 ease-in-out",children:"CSV"})]}),s.jsx(ye,{sx:{maxHeight:"calc(100vh - 100px)"},children:s.jsxs(we,{stickyHeader:!0,"aria-label":"sticky table",children:[s.jsx(Ce,{children:s.jsxs(z,{children:[s.jsx(l,{padding:"checkbox",sx:{padding:"1px",fontSize:"12px"},children:s.jsx(M,{indeterminate:n.length>0&&n.length<T.length,checked:n.length>0&&n.length===I().slice(i*c,i*c+c).length,onChange:ie})}),s.jsx(l,{align:"center",sx:{minWidth:50,fontWeight:600,fontSize:"12px"},children:"ID"}),["Transfer From","Transfer To","Description","Request By","Request On","Action"].map(e=>s.jsx(l,{className:"capitalize text-nowrap",align:"center",sx:{minWidth:120,fontWeight:600,fontSize:"12px"},children:e.toUpperCase()},e))]})}),s.jsx(be,{sx:{padding:"2px"},children:g.slice(i*c,i*c+c).map((e,r)=>s.jsxs(z,{hover:!0,role:"checkbox",tabIndex:-1,selected:n.includes(e.id),children:[s.jsx(l,{padding:"checkbox",sx:{padding:"1px",fontSize:"10px"},children:s.jsx(M,{checked:n.includes(e.id),onChange:()=>de(e.id)})}),s.jsx(l,{align:"center",sx:{padding:"1px",whiteSpace:"nowrap"},children:r+1+i*c}),s.jsx(l,{align:"center",sx:{padding:"1px",whiteSpace:"nowrap"},children:e.from_location}),s.jsx(l,{align:"center",sx:{padding:"1px",whiteSpace:"nowrap"},children:e.to_location}),s.jsx(l,{align:"center",sx:{padding:"1px",whiteSpace:"nowrap"},children:e.description}),s.jsx(l,{align:"center",sx:{padding:"1px",whiteSpace:"nowrap"},children:e.request_by}),s.jsx(l,{align:"center",sx:{padding:"1px",whiteSpace:"nowrap"},children:$(e.request_on)?new Date(e.request_on).toLocaleString():""}),s.jsxs(l,{align:"center",sx:{padding:"1px",whiteSpace:"nowrap"},children:[s.jsx(A,{title:"Approve",placement:"bottom",arrow:!0,children:s.jsx(j,{"aria-label":"approve",color:"success",onClick:()=>N("approve",e.id),children:s.jsx(B,{})})}),s.jsx(A,{title:"Reject",placement:"bottom",arrow:!0,children:s.jsx(j,{"aria-label":"reject",color:"error",onClick:()=>N("reject",e.id),children:s.jsx(W,{})})})]})]},e.id))})]})}),s.jsxs(J,{open:Z,onClose:b,children:[s.jsx(U,{children:"Confirm Action"}),s.jsx(H,{children:s.jsxs(V,{children:["Are you sure you want to ",y," transfer ID ",w,"?"]})}),s.jsxs(G,{children:[s.jsx(m,{onClick:b,color:"primary",children:"Cancel"}),s.jsx(m,{onClick:ae,color:"primary",autoFocus:!0,children:"Confirm"})]})]}),s.jsxs(J,{open:ee,onClose:S,children:[s.jsx(U,{children:"Confirm Mass Action"}),s.jsx(H,{children:s.jsxs(V,{children:["Are you sure you want to ",C," ",n.length," selected transfers?"]})}),s.jsxs(G,{children:[s.jsx(m,{onClick:S,color:"primary",children:"Cancel"}),s.jsx(m,{onClick:ue,color:"primary",autoFocus:!0,children:"Confirm"})]})]})]})}export{Ae as default};
